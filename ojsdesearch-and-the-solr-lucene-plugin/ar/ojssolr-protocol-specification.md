# مواصفات بروتوكول OJS/solr

## مواصفات API الداخلية

يوجد العديد من مكتبات التكامل PHP/solr للطرف الثالث، بما في ذلك ملحقات solr و PECL ، انظر [https://wiki.apache.org/solr/SolPHP](https://wiki.apache.org/solr/SolPHP). ولسوء الطالع، لم يدرج أي من هذه المواد رسميا في توزعات PHP و/أو الموزعة. ومن ثم فإن التحسين المنتظم لهذه التمديدات يضيف مزيدا من تكاليف الصيانة وتعقيدات التركيب. وعلاوة على ذلك، لا يمتثل أي من عناصر الطرف الثالث لسياسة PKP الرامية إلى الحفاظ على أقصى قدر من التوافق بين PHP وPHP إلى الخلف. وأخيرا، تبدو هذه المكتبات معقدة بشكل لا داعي له وعامة بشكل مفرط لحالات الاستخدام. لذلك نوصي بإنشاء مكتبة غلاف خفيفة الوزن ومتخصصة في PHP تخفي العمليات الداخلية لطلبات HTTP الخاصة بالواجهة الخاصة بالخدمات الداخلية السهلة الاستخدام. هذا سيمكننا من الحفاظ على رمز معالج OJS منفصلة عن منطق الاتصال السري مع الحفاظ على التعقيد إلى الحد الأدنى. يمكن الحفاظ على واجهة خدمة الموزع هذه داخل البرنامج المساعد الخاص بالموسري. نوصي باستخدام ملحق PHP curl\(\) للتواصل مع solr HTTP. ويستخدم هذا التمديد على نطاق واسع في مناطق أخرى من دائرة العدل والعدالة ويمكن بالتالي افتراض أنه موجود في معظم بيئات حواسيب خدمة دائرة العدل والعدالة. يمكننا استخدام حظر \(\) لوضع طلبات GET و POST لمعالجي طلبات الموزع على النحو المبين في الأقسام التالية. نقترح استخدام كاتب الاستجابة "phps" \("...&wt=phps..."\) عندما نريد استخدام بيانات الاستجابة في PHP. هذا أسهل للاستخدام، أسرع وأقل كثافة للذاكرة من استخدام XML كنموذج للاستجابة. عندما نستجيب لمكالمات AJAX \(على سبيل المثال للبحث الفوري أو تلقائي\)، نقترح استخدام كاتب الاستجابة JSON \(". .&wt=json..."\) لسهولة تغيير مسار الاستجابات الموسرة إلى عميل JavaScript OJS. سوف ترجع المكالمات الإدارية دائما XML الذي سيتعين علينا تحليله مع مكتبات الـ XML المتوافقة PHP4. حقيقة أننا نقوم بتنفيذ تكامل solr كإضافة عامة تتطلب إدخال تغييرات على كود OJS الأساسي: سيتعين علينا تقديم روابط إضافية تستدعي رمز المكون الإضافي في الأماكن المناسبة في رمز OJS الأساسي. وتنطبق القواعد التالية:

* إذا كان ذلك ممكناً، لا ينبغي وضع الروابط في الكود الذي سيتم إعادة إدخاله لاحقاً في البرنامج المساعد \(مثل الصفوف/البحث/ArticleSearchDAO. nc.php وأي طرق محددة لفهرس MySQL في الصفوف/البحث/ArticleSearch.inc.php و classes/search/ArticleSearchIndex.inc.php\).
* سوف نقدم مدير بحث في المواد لتحقيق الاتساق مع اتفاقيات التسمية في أماكن أخرى ولدينا وظائف فهرسة المقالات المفوضة لذلك الفصل. سيكون مسؤولا عن التذرع بأي إضافات يتم تكوينها وسيتم وضع روابط جديدة هناك. وينبغي تسمية الروابط تبعاً لذلك.

## بروتوكول الفهرس للصيانة

وبروتوكول صيانة الفهرس مسؤول عن تمكين الوصول إلى الكتابة من OJS إلى فهرس الموصل. وهو يوفر وظائف لإضافة/تحديث وحذف الوثائق. وكلتا الوظيفتين هي وظائف دفعات يمكن الاستناد إليها بمقالة واحدة أو العديد من المقالات في آن واحد.

### إضافة مستندات

كما رأينا أعلاه، يمكن دفع المقالات أو سحبها. في تكوين "الدفع"، سيتخذ OJS الإجراء كلما احتاج الأمر إلى إضافة مقالة أو أكثر أو تحديثها. في تكوين "سحب"، سيبدأ الموزع تحديثات الفهرسة بسبب جدول التحديث المركزي.

#### دفع المعالجة

التغييرات المدخلة على مقالة تؤدي إلى اتخاذ الإجراءات التالية:

1. كلما تغير جانب من جوانب المقال \(المادة - البيانات الوصفية أو الوديان أو البيانات الوصفية التكميلية للملف أو الملفات\)، رمز OJS الأساسي سيدعو API للفهرسة علامة على المقالة "تغير". لذلك نوصي بإعادة تسمية أساليب التحديث...\(\) والفهرس...\(\) وحذف...\(\) من فئة ماتيكلي سيريتشبيكس إلى ماد\(Metadata\<unk> File\<unk> files\<unk> \)Changed\(\)/suppFiletadataChanged\(\)/articleFileDeleted\(\). ولا يتعين تغيير إجراء هذه الوظائف لفهرسة SQL القديمة. هذا مجرد إعادة تسمية لتوثيق القصد المتغير من المكالمة. وهذا ما يترك الأمر لتنفيذ الفهرسة سواء أكان يريد تنفيذ النمط "القذر" أم لا.
2. عندما يتم إجراء جميع التغييرات على مقالة عندها سيقوم رمز OJS الأساسي بإبلاغ API بالفهرسة بأن جميع التغييرات قد تم إجراؤها. نوصي بإدخال طريقة "المقالة تشانغز إنهاؤه\(\)" إلى فئة ماتيكليسكس للبحث. وفهرسة التطبيقات التي لا تنفذ النمط "القذر" ستتجاهل ببساطة تلك النداء. الإضافات التي تنفذ نمط "القذرة" سوف تجمع الآن جميع التغييرات وتحديث الفهرس تبعاً لذلك. في حالة المكون الإضافي الموسر يعني أن مستند XML مع جميع البيانات الوصفية للمقال، بما في ذلك بيانات الوادي ذات الصلة والبيانات الوصفية للملف التكميلي للملف، يتم إرسال جميع المقالات "القذرة" عبر HTTP POST إلى معالج طلب OJS DIH . ./solr/ojs/dih الذي هو جزء من تكوين الموسر الافتراضي الموصى به.
3. للحفاظ على اتصال HTTP بأكبر قدر ممكن من الضوء، XML لا يحتوي على غاليل أو ملفات تكميلية ولكنه يحتوي فقط على روابط بوثائق نصية كاملة. تسحب DIH بشكل غير متزامن هذه الوثائق من خادم OJS لاستخراجها ومعالجتها المسبقة.
4. ولن يضع OJS علامة على مقالة على أنها "نظيفة" إلا إذا أشارت الاستجابة المقدمة من المصدر إلى نجاح الفهرسة. وللحفاظ على تبسيط التنفيذ قدر الإمكان، سيكون التنفيذ الأول متزامنا. إذا تبين أن هذا يجعل عميل OJS غير مستجيب، فيمكن استخدام إطار المعالجة الحالي لتنفيذ فهرسة غير متزامنة.
5. إذا أعيدت المعالجة خطأ ثم سيتم إرسال إشعار إلى المسؤولين التقنيين في OJS حتى يتمكنوا من تصحيح الخطأ. ولن تتغير حالة فهرسة المواد إلى ”النظيفة“. التحديث التالي سيحدث إما عندما تتغير مقالة أخرى أو عندما يقوم المشرف بتفعيل تحديث يدوي, إما من خلال صفحة الاستقبال الملحقة أو من خلال مفتاح تبديل إضافي لإعادة بناء SearchIndex. سكريبت hp

#### معالجة السحب

يمكن تنفيذ بروتوكول معالجة الجذب مثل هذا:

1. يعمل تحرير المقالات بنفس الطريقة التي يعمل بها بروتوكول الدفع أعلاه، مع استثناء أن مكالمة إلى طريقة المقالة ChangesFinished\(\) لن تفعل أي شيء \(=noop\) كفهرسة سوف تبدأ على الجانب الفردي بدلاً من أن تبدأ من قبل OJS. كلما تم إدخال تغيير على مقالة \(نشر، تغيير، غير نشر\) ، ستتغير حالة المقالة إلى "قذر". والطابع الذري لمعاملات قاعدة البيانات سيضمن أن الوصول المتزامن إلى العلم القذر سيتم على النحو السليم.
2. سيطبق خادم الموزع جدولا يبدأ الفهرسة \(على سبيل المثال عن طريق سكريبت cron script\). عندما يطلق البرنامج النصي المجدول، فإنه سيرسل طلب GET غير معلوم إلى نقطة نهاية OJS معروفة جيدا على نطاق التركيب.
3. عندما يتم تقديم طلب إلى نقطة نهاية خدمة الويب هذه، سيتم نشر جميع المقالات "القذرة" حتى الحد الأقصى لحجم الدفعة \(نفس حجم إعادة إكسينغ\) إلى خادم المورد عبر XML. XML المسحوبة \(أو رمز الاستجابة للطلب؟\) سوف تشير إلى ما إذا كان الرد يحتوي على جميع المقالات أو ما إذا كان يجب سحب دفعة أخرى في وقت لاحق. وإلا فإن XML في نفس التنسيق المستخدم للمعالجة بالدفع بحيث يمكن استخدام تكوين الدفع DIH بالكامل بدون تغيير لمعالجة الجذب.
4. جميع المقالات المسترجعة \(و فقط تلك التي تستخرج!\) سيتم وضع علامة "تنظيف" فورا. التغييرات التي تحدث أثناء طلب السحب يجب أن تكون قادرة على الاستمرار بشكل طبيعي. وهذا يعني أنه يتعين علينا أن نعيد تعيين العلم بشكل انتقائي لتجنب الظروف العرقية ولدعم معالجة الدفعات المتعددة.
5. البرنامج النصي المجدول على جانب الخادم سوف يحفظ XML المسترد في مجلد التجهيز كملف ذو معرف فريد \(على سبيل المثال\). ترتيب الملفات بالاسم يجب أن يؤدي إلى سلسلة ملفات FIFO في مجلد التجهيز.
6. إذا حدث خطأ \(على سبيل المثال مشاكل في الاتصال\) أثناء استلام XML ثم يجب على الخادم تجاهل كل ما تم استرجاعه حتى الآن ولا يمكن وضع علامة على أي مقالات "نظيفة" على جانب OJS.
7. إذا كان XML \(أو رمز الرد\) يشير إلى أنه يجب استرجاع المزيد من المقالات حينئذ سيقوم المجدول بذلك حتى يتم سحب جميع المقالات.

معالجة XML على جانب السيرفر:

1. سيتم التحقق من وجود ملف XML في مجلد التجهيز بواسطة سكريبت ثان على جانب الخادم. سيقوم باختيار الملف التالي الذي سيتم معالجته و POSTS إلى DIH المحلية التي ستقوم بمعالجته بنفس الطريقة كما في تكوين الدفع.
2. إذا كانت المعالجة ناجحة، فإن النص النصي للتصويت سوف يضغط على الملف وينقله إلى مجلد أرشيف. يجب أن يحافظ اسم الملف المضغوط على الطلب الفريد لتصحيح أو عرض أسهل. في حالة حدوث خطأ في المعالجة، سيقوم البرنامج النصي بإيقاف مؤقت ومحاولة معالجة الملف مرة أخرى. إذا تعذر، بعد ثلاث تكرارات، معالجة الملف بنجاح، سيتم نقلها إلى مجلد "الأخطاء" للتفتيش في وقت لاحق، ويواصل النص الانتخابي معالجة الملف التالي.

يرجى ملاحظة أنه سيكون علينا تنفيذ عملية معالج OJS إضافية لإرجاع قائمة مقالات XML. يجب علينا أيضا التأكد من أن المواد المعلَّمة بالحذف يمكن معالجتها بواسطة DIH \(والتي ليست ضرورية في حالة معالجة الدفع\). يمكننا القيام بذلك باستخدام خاصية $deleteDocById من معالج استيراد البيانات.

لأن الفهرسة هي عملية حذف/إضافة محتملة في لوسين، لن يؤدي رابط الشبكة أو أخطاء المعالجة خلال أي من الخطوات المذكورة أعلاه إلى مؤشر ناقص أو فاسد ما دامت DIH تؤكد الفهرسة بشكل صحيح. وإذا حدث أي خطأ في العملية، لن تضيع أي معلومات لأن جميع الملفات المخالفة ستحفظ للتفتيش اليدوي. بمجرد حل الخطأ، يمكن نقل الملف مرة أخرى إلى مجلد التجهيز الذي يتم استطلاعه بواسطة النص المجدول وسيتم معالجته على الفور من قبل الخادم.

إذا أصبح الفهرس تالفا فسيكون لدى مقدم الخدمة خيارين:

1. وإذا أمكن تحديد نقطة زمنية كان الفهرس فيها صحيحا وكان هناك نسخة احتياطية للفهرس في ذلك الوقت، عندئذ يمكن لمقدم الخدمة أن يعيد الفهرس وأن يختار جميع الملفات من المحفوظات التي تم سحبها بعد وقت النسخ الاحتياطي. يمكن "إعادة عرض" هذه الملفات عن طريق فك الضغط عليها ونقلها إلى مجلد التجهيز. ونظرا للطبيعة الودية لعملية الفهرسة ينبغي أن يؤدي ذلك إلى مؤشر سليم في جميع الحالات الممكنة تقريبا.
2. إذا لم يكن من الممكن إعادة تشغيل الملفات على فهرس النسخ الاحتياطي، فيمكن لمقدم الخدمة تشغيل برنامج نصي يميز جميع المقالات في جميع التثبيتات القذرة. وستعمل آلية الاقتراع على التأكد من أنه حتى وإن كانت هناك ملفات كثيرة ترد بسبب هذا الإجراء، سيحتفظ خادم الموسر بحمل مستمر حتى تتم إعادة فهرسة جميع المجلات. إذا كانت أسماء الملفات تحتوي على بعض الإشارات عن مصدر الملف \(أي ثم من السهل مراقبة عملية الفهرسة في مثل هذه الحالة عن طريق إصدار أوامر "ls some-file-pattern \<unk> wc -l" على مجلد التجهيز.

#### تنسيق XML لإضافة مقالة

وكما هو مبين في قسم التجهيز المسبق، نوصي باستخدام المكونات الإضافية المحلية لاستخراج البيانات. في حالتنا اخترنا معالج استيراد البيانات \(DIH\) لاستخراج المستندات ومعالجتها المسبقة.

وقد تم تقييم ما إذا كان مقدمو خدمات مراجعة الحسابات الحاليون، أي ويمكن استخدام نظام DIH مع نظام DIH، أو مودات أو MARC. كما تم تحليل ما إذا كان يمكن استيراد صيغ التصدير الأصلية \(أو غيرها من الصيغ الموجودة\). ومن المؤسف أن أيا منهما غير ممكن لأن إدارة الصحة العامة تفرض قيودا على نموذج تبادل البيانات التابع لمكتب العدل الياباني/سور:

* تنفيذ XPath الخاص بDIH لم يكتمل. فقط مجموعة فرعية من مواصفات XPath مدعومة. لا يمكن استخدام استفسارات XPath المؤهلة على عدة سمات والتي تستبعد تنسيق التصدير الأصلي لـ OJS . علينا أن نوفر صيغة بسيطة لـ XML يمكن تفسيرها مع DIH.
* عادة ما يقتصر تكامل تيكا في وزارة الصحة على عدد محدد من المستندات الثنائية لكل مستند لوسين. بيد أنه يتعين علينا في حالتنا أن ندعم فهرسة عدد دينامي تعسفي من الوديان والملفات التكميلية لكل مادة. نحن نعمل حول هذا الحد من خلال تضمين وثائق XML المغلفة بـ CDATA-wlap الخاصة بالوديان والملفات التكميلية في قائمة مقالات XML الرئيسية. ومن الممكن استخراج مثل هذه الوثائق على نحو منفصل في الحقول، فـ جنباً إلى جنب مع مصدر خاص للبيانات الميدانية ونظام DIH ScriptTransve ـ تجعل DIH "يعتقد" أنها تتعامل مع ملف ثنائي واحد في كل مرة. وهذا العمل يستبعد شكلي تصدير XML و OJS كصيغ مصدر DIH في حالتنا.

لحسن الحظ أن تنسيق تبادل تاريخ OJS/solr XML المطلوب بسيط جدا. يوجد تطبيق عينة يقوم بتنفيذ سكريبت SQL نقي لبناء XML للضغط على خادم اختبار الموسر من قاعدة بيانات اعتباطية OJS. ونموذج XML هو كما يلي:

* &lt;articleList&gt;...&lt;/articleList&gt;: هذا هو العنصر الجذري الذي يحتوي على قائمة كيانات المقال.
  * &lt;article id=”...” instId=”...” journalId=”...”&gt;...&lt;/article&gt;: هذا العنصر هو العنصر الفرعي الوحيد المسموح به من العنصر &lt;articles&gt; وعناصره الفرعية تحتوي على جميع البيانات الوصفية ومعلومات الملف لمقالة واحدة من مقالات OJS. تحتوي سمة المعرف على مزيج من معرف تنصيب OJS فريد من نوعه، ومعرّف المجلة ومعرّف المقالة. وهذا أمر ضروري لكي تكون الهويات فريدة حتى عندما يجمع مقدمو الخدمات بيانات المقالات من عدة منشآت في فهرس بحث واحد. ويحتوي المصطلحان "مثبت" و"صحفي" على هوية التركيب ومعرفة الصحف على نحو منفصل، وهو ما سيلزم لأغراض إدارية، مثل حذف دفعة من المقالات.
    * &lt;authorList&gt;&lt;author&gt;...&lt;/author&gt;...&lt;/authorList&gt;: الأسماء الكاملة لكاتب مقالة واحد أو عدة مؤلفين. يتم وضع هذا والعناصر التالية تحت العنصر &lt;article&gt;. إذا لم تكن المعلومات الخاصة بأي من حقول البحث هذه أو التالية متاحة، فإن العنصر سوف يكون مفقودا تماما. ترتيب المسائل المتعلقة بالعناصر في حالة المؤلفين.
    * &lt;titleList&gt;&lt;title locale=”...” sortOnly="\(true\|false\)"&gt;...&lt;/title&gt;...&lt;/titleList&gt;: عنوان المقال مع محله. ترتيب العناصر الفرعية لا يهم هذا أو حقول البيانات الوصفية التالية. ويستخدم علم "فرز أونلي" للإشارة إلى ما إذا كان العنوان المعطى سيستخدم في ترتيب مجموعة النتائج فقط. قد يحدث هذا عندما لا يوجد عنوان لبلدة معينة ويعرض OJS عنوان "مترجم" بدلاً من ذلك يختلف عن بلدة العرض المختارة حالياً.
    * &lt;abstractList&gt;&lt;abstract locale=”...”&gt;...&lt;/abstract&gt;...&lt;/abstractList&gt;: خلاصات المقالة المحلية
    * &lt;disciplineList&gt;&lt;discipline locale=”...”&gt;...&lt;/discipline&gt;...&lt;/disciplineList&gt;: تخصصات المقالات المحلية
    * &lt;subjectList&gt;&lt;subject locale=”...”&gt;...&lt;/subject&gt;...&lt;/subjectList&gt;: مواضيع المقالات المترجمة.
    * &lt;typeList&gt;&lt;type locale=”...”&gt;...&lt;/type&gt;...&lt;/typeList&gt;: أنواع المقالات المترجمة.
    * &lt;coverageList&gt;&lt;coverage locale=”...”&gt;...&lt;/coverage&gt;...&lt;/coverageList&gt;: قائمة الكلمات الرئيسية للتغطية \(تتوافق مع التغطية الجغرافية والوقت والعينة\).
    * &lt;journalTitleList&gt;&lt;journalTitle locale=”...” sortOnly="\(true\|false\)"&gt;...&lt;/journalTitle&gt;...&lt;/journalTitleList&gt;: عنوان المجلة جنبا إلى جنب مع اللغة المحلية الخاصة بها ورتب العلم فقط.
    * &lt;publicationDate&gt;...&lt;/publicationDate&gt;: تاريخ نشر المقالة بتنسيق ISO 8601 بدون كسور ثانية \("YYYY-MM-DDTHH:MM:SSZ"\). تعامل جميع التواريخ على أنها تواريخ UTC. ويجب على مكتب العدل الياباني ترجمة تواريخ النشر المحلية إلى UTC قبل إرسالها إلى المبيع.
    * &lt;issuePublicationDate&gt;...&lt;/issuePublicationDate&gt;: تاريخ نشر المشكلة بتنسيق ISO 8601.
    * &lt;galley-xml&gt;...&lt;/galley-xml&gt;: حقل تشفير UTF-8 CDATA الذي يحتوي على ملف XML مضمن \(بما في ذلك &lt;?xml …?&gt; رأس يجب علينا تضمين هذا XML حتى يمكن لملحق solr DIH أن يعالجه بشكل منفصل أثناء معالجة الاستيراد. هذا هو العمل حتى نتمكن من استيراد عدة ملفات ثنائية لمقالة واحدة.
    * &lt;suppFile-xml&gt;...&lt;/suppFile-xml&gt;: UTF-8 حقل تشفير CDATA يحتوي على XML المدمج مع بيانات ملف تكميلية. راجع &lt;galley-xml&gt; أعلاه للحصول على تفسير لماذا قمنا بتضمين بث أحرف XML ثانوي.

وصف الوادي المدمج XML:

* &lt;galleyList&gt;...&lt;/galleyList&gt;: تغلف قائمة من الودان. هذا هو عنصر الجذر من ملف XML المدمج في &lt;galley-xml&gt;...&lt; /galley-xml&gt;.
  * &lt;galley locale="....” mimetype="....” url="..." /&gt;: عنصر يمثل وادي واحد. وليس لها عناصر فرعية. سمة النمط هي نوع MIME كما تم تخزينها في فئة ملف OJS. يشير عنوان URL السمة إلى عنوان URL لملف النص الكامل. ستقوم DIH بسحب الملف من هناك على الشبكة واستخراج محتوياتها.

وصف للملف التكميلي المدمج XML:

* &lt;suppFileList&gt;...&lt;/suppFileList&gt;: تغلف قائمة من الملفات التكميلية. هذا هو عنصر الجذر في ملف XML المدمج في
&lt;suppFile-xml&gt;...&lt;/suppFile-xml&gt;.
  * &lt;suppFile locale=”...” mimetype=”...” url=”...”&gt;...&lt;/suppFile&gt;: عنصر يمثل ملفاً إضافياً واحداً. ويحتوي على عناصر فرعية أخرى مع بعض البيانات الفوقية التكميلية للملفات. راجع العنصر &lt;galley&gt; أعلاه تعريف سمات النمط والنمط الرابط. ويتعين على OJS أن يتأكد من أن المحل المحلي هو أحد محليات OJS الصالحة أو "مجهول". ويتطلب ذلك تحويلا داخليا للغة الملفات التكميلية إلى صيغة محرر OJS المكونة من 5 حروف إن أمكن.
    * &lt;titleList&gt;&lt;title locale=”...”&gt;...&lt;/title&gt;...&lt;/titleList&gt;: ملفات إضافية تم توطين معلومات العنوان.
    * &lt;creatorList&gt;&lt;creator locale=”...”&gt;...&lt;/creator&gt;...&lt;/creatorList&gt;: منشئ الملفات التكميلية.
    * &lt;subjectList&gt;&lt;subject locale=”...”&gt;...&lt;/subject&gt;...&lt;/subjectList&gt;: مواضيع الملفات التكميلية.
    * &lt;typeOtherList&gt;&lt;typeOther locale=”...”&gt;...&lt;/typeOther&gt;...&lt;/typeOtherList&gt;: أنواع الملفات التكميلية.
    * &lt;descriptionList&gt;&lt;description locale=”...”&gt;...&lt;/description&gt;...&lt;/descriptionList&gt;: أوصاف الملفات التكميلية.
    * &lt;sourceList&gt;&lt;source locale=”...”&gt;...&lt;/source&gt;...&lt;/sourceList&gt;: مصادر الملفات التكميلية.

&lt;articleList&gt; هو العنصر الإلزامي الوحيد. جميع العناصر &lt;\*القائمة&gt; الأخرى تحتوي على البطاقة 0..1 فيما يتعلق بعناصرها الأصلية. وجميع العناصر الأخرى لها أساس 0..n فيما يتعلق بعناصرها الأم.

يستمع معالج التحديث في "[http://127.0.0.1:8983/solr/ojs/dih"](http://127.0.0.1:8983/solr/ojs/dih”) في تكوين خادم سور المضمنة الافتراضي سيكون قادرا على استهلاك تنسيق XML هذا.

### تحديث المستند

عندما يقوم المستخدم بتحديث مقالة من مقالات OJS أو ملف الوادي أو ملف تكميلي، سيتعين إعادة فهرسة جميع الوثائق والبيانات الفوقية التي تخص نفس المقالة.

Lucene لا يدعم التحديث الجزئي للمستندات المفهرسة مسبقاً. ولذلك فإن بروتوكول OJS/solr لا يطبق صيغة محدَّثة محددة. إضافة مستند ذو معرف موجود بالفعل في الفهرس سيؤدي تلقائيا إلى حذف المستند الحالي وإضافة الوثيقة المحدثة.

للاطلاع على مزيد من التفاصيل، انظر البروتوكول للاطلاع على إضافة المستندات.

### حذف المستندات

ونقترح دعم أربع حالات استخدام:

* حذف مقالة واحدة من الفهرس
* حذف جميع مقالات المجلة
* حذف جميع المقالات من التثبيت
* حذف جميع المقالات في الفهرس

مطلوب حذف مقالة واحدة من الفهرس عندما يكون مقالة غير منشورة في OJS \("مرفوضة ومحفوظة"\). سيلزم حذف المقالات من مجلة أو تثبيت عندما \(جزئيا\) إعادة بناء فهرس، انظر مواصفات الواجهة أعلاه. ولا يختلف حذف جميع المواد في الفهرس إلا عن الحالة الثالثة في السيناريوهين S3 و S4. وبما أن هذه العمليات هي عمليات شاملة للتركيبات، فإننا لا نوصي بتوفير وصلة بينية للمستعمل النهائي لهذه المهمة في مكتب العدل الإسلامي. ونوصي بدلا من ذلك بأن يقوم مقدمو الخدمات بحذف أو نقل دليل الفهرس الخاص بهم كليا أو إنشاء فهرس جديد في الخلفية في نواة منفصلة والتحول إلى هذا النواة بعد إعادة البناء باستخدام الوصول المباشر إلى واجهة الويب الموسعة.

يمكن دعم جميع حالات الاستخدام الأخرى من خلال استدعاء معالج التحديث الأصلي ".../solr/ojs/update" مع الصيغة المعتادة &lt;delete&gt;...&lt;/delete&gt; من داخل OJS. نحن نقدم معرفات اليومية والتثبيت في نموذج البيانات الخاص بنا حتى نتمكن من حذف جميع المستندات من هذه الكيانات مع حذف استعلام بحث بسيط.

عند العمل مع التحديثات المدفوعة، يمكن الضغط فورا على جميع الوثائق المحذوفة لإعادة الفهرسة إذا لزم الأمر. عند العمل مع التحديثات سيتم وضع علامة على المقالات المحذوفة "غير مفهرسة" بحيث يتم إعادة فهرستها تلقائياً في المرة القادمة التي يصل فيها طلب السحب من خادم المجند.

### النشر القائم على الاشتراك

لكي يتمكن خادم Solr من الوصول إلى محتوى الاشتراك فقط على الخادم، سيرفره IP يجب أن يكون مأذونا به ك"مشترك مؤسسي". سوف نتأكد من أن فحوص الاشتراك العادي ستكون صالحة في سيناريو الجذب. وهذا يعني أن خدمة ويب XML الخاصة بنا للمقالات "القذرة" سوف توفر الوصول إلى المقالات المحمية للاشتراك فقط إذا كان الخادم الطالب قادراً على توثيق نفسه بشكل صحيح وتم الإذن له بالوصول إلى بيانات المقالة.

## بروتوكول البحث

ويشكل بروتوكول البحث التابع لمكتب العدل الياباني/سول استفسار ”edismax“ الموثق جيدا ونموذج النتائج. نحن لا نستنسخ الجملة العامة "edismax" هنا. يرجى الرجوع إلى الوثائق الرسمية للعازفين للحصول على التفاصيل.

نقوم بتنفيذ معالج طلب بحث مخصص لاستفسارات البحث OJS. في السيناريو المدمج سوف يستمع إلى الطلبات في "[http://127.0.0.1:8983/solr/ojs/search"](http://127.0.0.1:8983/solr/ojs/search%E2%80%9D). نحن لا نضع الاستفسارات من خلال المعالج الافتراضي للطلب "/select". لا ينبغي لهذا المعالج أن يسمح بالوصول العام في التكوين الافتراضي لأنه يسمح للطلبات المباشرة إلى معالج الطلب الإداري الخاص بالعازل.

تكوين معالج طلبنا الخاص له مزايا إضافية:

* يمكننا تكوينه مسبقاً مع معلمات إلزامية لا يمكن تغييرها من جانب العميل. ويساعد ذلك على ضمان معالجة طلبنا إلى حد ما ويقلل من كمية البارامترات التي يتعين تمريرها من مكتب العدل والأمن.
* نقوم بتمكين المستخدمين المتقدمين لضبط جميع معلمات البحث \(إلزامية أو افتراضية\) تقريبا دون الحاجة إلى تغيير رمز OJS.
* نقوم بتمكين المستخدمين المتقدمين لتحديد نقاط نهاية البحث المقيدة الخاصة بهم \(على سبيل المثال تصفية على فئة معينة من الصحف\) إذا قاموا بتطبيق خادم بحث على نطاق مقدمي الخدمات. ويمكن بعد ذلك تكوين هذه النقاط النهائية كنقاط نهاية بحث مخصصة في OJS، انظر أعلاه "تكوين سيناريو الانتشار".

نحن نستخدم فقط مجموعة فرعية من خيارات البحث "edismax". وقد ورد وصف هذه المجموعة الفرعية في الفصل "الاستفسار" أعلاه. يرجى الرجوع هناك للحصول على تفاصيل عن أجزاء البروتوكول التي يتم استخدامها بالفعل من قبل وصول البحث في OJS إلى الموصل.
