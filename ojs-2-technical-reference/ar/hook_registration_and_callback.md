# تسجيل الرابط واستعادة المكالمة

ويستخدم المثال المذكور أعلاه كمثال توضيحي واضح على تسجيل الرابط واستدعاء المكالم؛ وإلى جانب قائمة الروابط أدناه، ينبغي أن توفر هذه المعلومات جميع المعلومات المطلوبة لتوسيع نطاق نظام الاتصالات السلكية واللاسلكية باستخدام الروابط. ومع ذلك، هناك بعض التفاصيل الهامة التي تحتاج إلى مزيد من الدراسة.

وفيما يلي العملية التي يتم بواسطتها تسجيل المكون الإضافي مقابل الرابط:

**مثال 5-3. عملية تسجيل الروابط**

````
Hookregistry:::register(
    'قوالب::Manager::Index::ManagementPages',
    الصفيفة(&$this، 'استرداد')
);
````

في المثال الوارد أعلاه، المعلمات ل `Hookregistry::regisy` هي:

1. اسم الرابط. انظر القائمة الكاملة للروابط أدناه.
2. وظيفة الاستدعاء التي ينبغي أن تنقل إليها السيطرة عند مواجهة الرابط. هذا هو نفس تنسيق الرد على المكالمات الذي تستخدمه دالة `call_user_func` في PHP؛ راجع التوثيق على http://php.net لمزيد من المعلومات. من المهم أن يتم تضمين `$this` في المصفوفة عن طريق المراجعة، أو قد تواجه مشاكل مع مثيلات متعددة من كائن الإضافة.

ويرد فيما يلي تعريف لوظيفة الاستدعاء (المسمى والموجود في مكالمة التسجيل الآنفة الذكر):

**مثال 5-4. تعريف تسجيل الروابط**

````
function callback($hookName, $args) { 
    $params =& $args[0]; 
    $smarty =& $args[1]; 
    $output =& $args[2]; 
    ... 
} 
````

قائمة المعلمات لوظيفة رد الاتصال هي نفسها دائماً:

1. اسم الرابط الذي أدى إلى التحكم في تلقي الرد على المكالمات (والذي يمكن أن يكون مفيدا عندما يتم تسجيل عدة روابط مع نفس وظيفة الرد على المكالمة)، و
2. وانتقلت مجموعة من البارامترات الإضافية إلى المكالمة. وتتوقف محتويات هذه المجموعة على تسجيل الرابط ضدها. نظرًا لأن هذا هو رابط قالب، يمكن أن يتوقع رد الاتصال المعلمات الثلاثة المذكورة أعلاه.

إن تمرير البارامترات على أساس المصفوفة مرهق بعض الشيء، ولكنه يسمح للمكالمات الرابضة بتمرير الإشارات إلى البارامترات إذا رغبت في ذلك. خلاف ذلك على سبيل المثال ستتلقى الكود أعلاه كائناً ذكياً مكرراً بدلاً من الكائن الذكي الفعلي وأي تغييرات على سمات الكائن `$smarty` ستختفي عند العودة.

أخيراً، قيمة الإرجاع من رد المكالمة الرابطة مهمة جداً. إذا رجع رابط الاتصال `صحيح`، ويعتبر سجل الرابط أن رد الاتصال هذا "تعامل" نهائياً مع الرابط ولن يستدعي المزيد من الاتصالات المسجلة على نفس الرابط. إذا عاد رد الاتصال `خطأ`، المكالمات الأخرى المسجلة على نفس الرابط بعد أن تكون هناك فرصة للتعامل مع المكالمة الرابطة.

ويضيف المثال الوارد أعلاه وصلة إلى قائمة مدير اليومية لمهام الإدارة. إذا تم تسجيل إضافة أخرى (أو حتى نفس الإضافة) لإضافة رابط آخر إلى نفس القائمة، وقد أعادت هذه الإضافة `true`، لن يتم استدعاء تسجيل الرابط التابع للملحق الآخر.