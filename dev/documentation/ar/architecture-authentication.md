---
title: المصادقة - التوثيق الفني - OJS<unk> OMP<unk> OPS
---

# المصادقة

يتم استخدام ملفات تعريف الارتباط لمصادقة جلسة المستخدم ضد مستخدم مسجل ``. يمكنك استرداد المستخدم المسجل حاليا من `طلب` الكائن:

```php
$currentUser = $request->getUser();
إذا (!$currentUser) {
    // المستخدم لم يتم تسجيل الدخول
}
```

`الطلب` متاح عالميا من `التطبيق`.

```php
$currentUser = تطبيق::get()->getrequest()->getUser();
```

## رموز CSRF

يجب إرسال رموز CSRF مع جميع `POST`، `طلبات التزييف` أو `رفض` لمنع الهجمات باستخدام [طلب التزوير عبر الموقع](https://en.wikipedia.org/wiki/Cross-site_request_forgery).

رموز CSRF غير مطلوبة مع طلبات API عند استخدام [رمز API](/dev/api/#api-token)

وقد يطلب من الدورة الحالية الحصول على رمز لهذا الإطار.

```php
$csrfToken = $request->getSession()->getCSRFToken();
```

### طرق الصفحة

عندما يتلقى معالجو الصفحات طلبات `POST`أو `PUT` أو `الحذف` ينبغي معالجة أي بيانات استمارة بواسطة `استمارة`. في مثل هذه الحالات، يجب أن تضيف الاستمارة `` التحقق من CSRF إلى قواعد التحقق الخاصة بها.

```php
نموذج نموذج الصف يمتد النموذج {
    وظيفة __construct(...) {
        $this->addCheck(FormValidatorCSRF($this));
    }
}
```

### طرق التحكم

يجب على المتحكمين التحقق من رمز CSRF لأي أسفل يتلقى طلب `POST`أو `PUT` أو `الحذف`.

```php
الفئة العدد GridHandler {
    وظيفة حذف المشكلة ($args، $request{
        إذا (!$request->التحقق من CSRF()) {
            إرجاع JSONMessage(alse)؛
        }
    }
}
```

### طرق API

التحقق تلقائياً من رمز CSRF لجميع الطلبات `POST`أو `PUT` أو `DLETE`. ويجب عدم اتخاذ أي إجراء إضافي.

## جلسة المستخدم
تخزن جلسة المستخدم عنوان IP الخاص بالمستخدم، والتاريخ / الوقت المستعمل الأخير والمزيد. يمكنك الوصول إلى جلسة المستخدم الحالية مباشرة.

```php
$sessionManager = مدير الدورة: :getManager();
$session = $sessionManager->getUserSession();
```

استخدام `مدير الدورة` لا يشجع إلا إذا كنت بحاجة إلى الوصول إلى الجلسة نفسها. في جميع الحالات، يجب استرجاع `المستخدم الحالي` من `طلب` الكائن.

## أدوات CLI

لن يكون هناك مستخدم مسجل الدخول عند استخدام أدوات CLI. ويجب توخي الحذر عند كتابة الرمز الذي يحصل على المعلومات من قاعدة البيانات أو يعدلها لضمان إمكانية استخدامها في حالة عدم وجود جلسة للمستخدم.

يجب أن يقوم المعالجون [](./architecture-handlers) بأداء أي مصادقة أو إذن مطلوب قبل تلبية الطلب.

---

الآن بعد أن كنا نعرف من هو المستخدم، تعلم [كيف نأذن لهم بالوصول إلى عمليات مختلفة](./architecture-authorization).